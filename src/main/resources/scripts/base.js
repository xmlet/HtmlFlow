"use strict";(()=>{var a=class extends HTMLElement{constructor(){super();this.mfeName="";this.mfeUrlResource="";this.mfeListeningEventName="";this.mfeTriggerEventName="";this.readyEventSuffix="-fragment-ready";this.mfeStylingUrl="";this.isMfeStreamingData="";this.attachShadow({mode:"open"})}connectedCallback(){this.mfeUrlResource=this.getAttribute("mfe-url"),this.mfeName=this.getAttribute("mfe-name"),this.mfeStylingUrl=this.getAttribute("mfe-styling-url"),this.mfeListeningEventName=this.getAttribute("mfe-listen-event"),this.mfeTriggerEventName=this.getAttribute("mfe-trigger-event"),this.isMfeStreamingData=this.getAttribute("mfe-stream-data"),this.mfeListeningEventName&&window.addEventListener(this.mfeListeningEventName,this.reloadFragment.bind(this)),this.loadFragment()}async fetchData(){if(this.mfeUrlResource){let e=await fetch(this.mfeUrlResource);if(!e.ok)throw new Error(`Failed to fetch ${this.mfeUrlResource}: ${e.status}`);return e.text()}}async fetchStreamData(){if(this.mfeUrlResource){this.wrapper=document.createElement("div");let e=await fetch(this.mfeUrlResource);if(e.body)for await(let i of e.body){let t=new Uint8Array(i),n=new TextDecoder().decode(t);this.wrapper.insertAdjacentHTML("beforeend",n),this.shadowRoot?.appendChild(this.wrapper)}}}buildFragment(e){let t=new DOMParser().parseFromString(e,"text/html");this.shadowRoot&&(this.shadowRoot.innerHTML="");let n=document.createDocumentFragment(),r=document.createElement("link");return this.mfeStylingUrl&&(r.setAttribute("rel","stylesheet"),r.setAttribute("href",this.mfeStylingUrl),n.append(r)),t.body.childNodes.forEach(s=>{n.append(s)}),this.shadowRoot?.appendChild(n)}triggerEvent(e,i,t,n=!0,r=!0){let s=new CustomEvent(e,{detail:{message:i,payload:t},bubbles:n,composed:r});dispatchEvent(s)}reloadFragment(){this.loadFragment()}loadFragment(){this.isMfeStreamingData==="true"?this.fetchStreamData().then(e=>console.info("Finished fetching stream!")).catch(e=>console.error(e)):this.fetchData().then(e=>{e&&(this.buildFragment(e),console.log("eventname: ",this.mfeName+this.readyEventSuffix),this.dispatchEvent(new Event(this.mfeName+this.readyEventSuffix,{bubbles:!0,composed:!0})))})}disconnectedCallback(){console.log("Custom element removed from page.")}adoptedCallback(){console.log("Custom element moved to new page.")}attributeChangedCallback(e,i,t){console.log(`Attribute ${e} has changed from ${i} to ${t}.`)}};window.customElements.define("micro-frontend",a);})();
